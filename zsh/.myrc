# .myrc
# Matt the Person


# --------------------------------
# GENERAL

bindkey -s '^H' '~/'
# xset r rate 150 40 # x11 (no Wayland)


# --------------------------------
# ALIASES

alias lx="ls -lXh"

alias ff="fzf"
alias fff="fdfind . --type f | fzf"
alias ffd="fdfind . --type d | fzf"

alias tedit="nvim"
alias fe="dolphin . &"
#alias myconfig="tedit $CONF_MY"
#alias mdless="snap run mdless"

alias gitsync="git add . && git commit -m 'git sync' && git pull --rebase && git push"


# --------------------------------
# ENV VARIABLES

export CONF_MY="$HOME/.myrc"
export CONF_ZSH="$HOME/.zshrc"
export CONF_BASH="$HOME/.bashrc"
export CONF_ZSHTHEME="$ZSH/custom/themes/$ZSH_THEME.zsh-theme"
export CONF_NVIM="$HOME/.config/nvim/init.lua"
export CONF_TMUX="$HOME/.tmux.conf"

#export CHEAT_VIM="$HOME/cheatsheets/vim.md"
#export CHEAT_TMUX="$HOME/cheatsheets/tmux.md"

export WINHOME="/mnt/c/Users/stirl/" # Windows home (WSL)


# --------------------------------
# SHELL FUNCTOINS

# Function for cd-ing into the directory of a utility
cmdcd() {
    if [[ -z "$1" ]]; then
        echo "Usage: cmdcd UTILITY"
        return 1
    fi

    # Get the full path of the utility
    local CMD_PATH
    CMD_PATH=$(which "$1" 2>/dev/null)

    if [[ -z "$CMD_PATH" ]]; then
        echo "Command '$1' not found."
        return 1
    fi

    # Resolve symbolic links to the actual file
    local REAL_PATH
    REAL_PATH=$(readlink -f "$CMD_PATH")

    # Extract the directory and change to it
    local CMD_DIR
    CMD_DIR=$(dirname "$REAL_PATH")

    cd "$CMD_DIR" || {
        echo "Failed to cd into $CMD_DIR."
        return 1
    }

    echo "Changed directory to $CMD_DIR"
}


# cd into dir and list contents
cdl() {
    cd "$1" && ls -lah
}


# YOING & YEET

export YOINKED_CLIPBOARD="/tmp/yoinked_clipboard"

yoink() {
    
    # read "$1"
    local src="$1"

    # check if $1 exists
    if [[ -z "$src" || ! -e "$src" ]]; then
        echo "Source does not exist."
        return 1
    fi

    # write to file
    echo "$(realpath "$src")" > "$YOINKED_CLIPBOARD"
    echo "Added item to yeet: $src"
}

yeet() {

    # check if file exists
    if [[ ! -f "$YOINKED_CLIPBOARD" ]]; then
        echo "Nothing to yeet!"
        return 1
    fi

    # read from file and check if src exists
    local src
    src=$(<"$YOINKED_CLIPBOARD")
    if [[ ! -e "$src" ]]; then
        echo "Yeetable item doesn't exist: $src"
        rm -f "$YOINKED_CLIPBOARD"
        return 1
    fi

    # yeet check
    if [[ "$1" == "check" ]]; then
        echo "$src"
        return 0
    fi

    # yeet copy
    if [[ "$1" == "copy" ]]; then
        if ! cp -r "$src" .; then
	        echo "Failed to copy $src"
	        return 1
	    fi
	    echo "Copied: $(basename "$src")"
	    return 0
    fi

    # yeet UNKNOWN
    if [[ -n "$1" ]]; then
        echo "Unknown yeet command $1. Use 'check' or 'copy'"
        return 1
    fi

    # attempt mv src dst
    if ! mv "$src" .; then
        echo "Failed to move $src"
        return 1
    fi
    echo "Yeeted: $(basename "$src")"
    rm -f "$YOINKED_CLIPBOARD"
}


# yazi: escape to folder
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	command yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ "$cwd" != "$PWD" ] && [ -d "$cwd" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}


